<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Social Ease â€” Calm Corner</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body data-page="calm">
  <header>
    <h1>Calm Corner ðŸ«§</h1>
    <p>Watch soft bubbles float and breathe with them.</p>
    <nav>
      <a href="index.html" class="nav-link">Home</a>
      <a href="challenges.html" class="nav-link">Challenges</a>
      <a href="calm.html" class="nav-link">Calm Corner</a>
      <a href="reflection.html" class="nav-link">Reflections</a>
    </nav>
    <button id="low-stim-toggle" class="small-toggle">ðŸŒ“ Low-Stimulation</button>
  </header>

  <main>
    <section class="card">
      <div class="calm-area">
        <div id="bubble-stage" class="bubble-stage" aria-hidden="true"></div>
        <div class="calm-text">
          <p>Breathe in slowly for 4... hold 2... breathe out for 6.</p>
          <p class="affirm">Affirmation: I am safe. I can pause. I can connect.</p>
          <div class="calm-controls">
            <button id="pause-btn" class="action-btn subtle">Pause Animation</button>
            <button id="resume-btn" class="action-btn subtle">Resume Animation</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script src="common.js"></script>
  <script>
    // Calm page: create animated bubbles with blue/green pastel colors
    const stage = document.getElementById('bubble-stage');
    const pauseBtn = document.getElementById('pause-btn');
    const resumeBtn = document.getElementById('resume-btn');

    const bubbleColors = [
      'rgba(160, 210, 235, 0.35)', // pastel blue
      'rgba(173, 222, 201, 0.35)', // pastel mint
      'rgba(200, 220, 240, 0.30)', // pale blue
      'rgba(205, 190, 230, 0.28)'  // soft lilac (subtle)
    ];

    function createBubbles(count = 12) {
      stage.innerHTML = '';
      for (let i = 0; i < count; i++) {
        const b = document.createElement('div');
        b.className = 'bubble';
        const size = 24 + Math.random() * 70;
        b.style.width = `${size}px`;
        b.style.height = `${size}px`;
        b.style.left = `${Math.random() * 100}%`;
        b.style.bottom = `${-Math.random() * 40}px`;
        b.style.background = bubbleColors[Math.floor(Math.random() * bubbleColors.length)];
        b.style.opacity = 0.45 + Math.random() * 0.25;
        b.style.animationDuration = `${8 + Math.random() * 8}s`;
        b.style.animationDelay = `${Math.random() * 4}s`;
        stage.appendChild(b);
      }
    }

    // Pause/Resume by toggling animation-play-state or hiding
    function pauseBubbles() {
      stage.querySelectorAll('.bubble').forEach(b => {
        b.style.animationPlayState = 'paused';
        b.style.opacity = '0.25';
      });
    }
    function resumeBubbles() {
      stage.querySelectorAll('.bubble').forEach(b => {
        b.style.animationPlayState = 'running';
        b.style.opacity = '';
      });
    }

    pauseBtn.addEventListener('click', pauseBubbles);
    resumeBtn.addEventListener('click', resumeBubbles);

    // Create bubbles initially
    createBubbles(14);

    // If low-stim mode active, hide or pause animation
    if (document.body.classList.contains('low-stim')) {
      pauseBubbles();
      stage.style.visibility = 'hidden';
    }

    // Also respond to low-stim changes fired by common.js (it toggles class on body)
    window.addEventListener('storage', (e) => {
      if (e.key === 'low-stim') {
        if (localStorage.getItem('low-stim') === 'true') {
          pauseBubbles();
          stage.style.visibility = 'hidden';
        } else {
          stage.style.visibility = '';
          resumeBubbles();
        }
      }
    });
  </script>
</body>
</html>
