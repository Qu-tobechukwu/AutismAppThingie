<!doctype html>
<html lang="en" data-page="challenges">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Social Ease — Challenges</title>
  <link rel="stylesheet" href="style.css">
  <script src="common.js" defer></script>
</head>
<body>

<header class="site-header">
  <div class="header-row">
    <div class="brand">
      <img src="assets/logo.png" alt="Social Ease logo" class="site-logo">
      <div class="brand-text"><h1>Social Ease</h1><div class="tagline">Daily & professional settings — support for social ease</div></div>
    </div>

    <button id="nav-toggle" class="nav-toggle" aria-label="Toggle navigation">☰</button>

    <nav class="main-nav" role="navigation" aria-label="Main menu">
      <a href="index.html" class="nav-link">Home</a>
      <a href="challenges.html" class="nav-link">Challenges</a>
      <a href="social-cues.html" class="nav-link">Social Cues</a>
      <a href="calm-corner.html" class="nav-link">Calm Corner</a>
      <a href="reflections.html" class="nav-link">Reflections</a>
      <a href="progress.html" class="nav-link">Progress</a>
      <a href="settings.html" class="nav-link">Settings</a>
    </nav>

    <div class="header-controls">
      <button id="low-stim-toggle" class="icon-btn" aria-pressed="false" title="Toggle Low-Stim">🌓</button>
      <button id="voice-toggle" class="icon-btn" aria-pressed="false" title="Toggle Voice Hints">🔈</button>
      <a href="settings.html" class="icon-btn" title="Settings">⚙️</a>
    </div>
  </div>
</header>

<main class="centered">
  <section class="card">
    <h2>🎯 Challenges — pick an event type</h2>
    <p>Click any event to show suggested challenges and sensory tips. Click a challenge to mark it done.</p>

    <div id="events-grid" class="events-grid">
      <!-- Event cards generated by JS fallback but include static examples for quick copy -->
      <div class="event-card" data-event="workplace">
        <h3>🏢 Work / Office</h3>
        <p class="clear-instruction">Instruction: Click "Show" for challenges. Click "Sensory Tips" for environmental help.</p>
        <div class="event-actions">
          <button class="pill-btn small" onclick="renderEvent('workplace')">Show</button>
          <button class="pill-btn small outline" onclick="showSensoryTips('workplace')">Sensory Tips</button>
        </div>
      </div>

      <div class="event-card" data-event="family">
        <h3>👪 Family Gatherings</h3>
        <p class="clear-instruction">Instruction: Click "Show" to view gentle steps and examples.</p>
        <div class="event-actions">
          <button class="pill-btn small" onclick="renderEvent('family')">Show</button>
          <button class="pill-btn small outline" onclick="showSensoryTips('family')">Sensory Tips</button>
        </div>
      </div>

      <div class="event-card" data-event="party">
        <h3>🎉 Parties / Social Events</h3>
        <p class="clear-instruction">Instruction: Use breaks when needed — details below.</p>
        <div class="event-actions">
          <button class="pill-btn small" onclick="renderEvent('party')">Show</button>
          <button class="pill-btn small outline" onclick="showSensoryTips('party')">Sensory Tips</button>
        </div>
      </div>

      <div class="event-card" data-event="public">
        <h3>🏛 Public Places / Errands</h3>
        <p class="clear-instruction">Instruction: Plan route and quiet spots in advance.</p>
        <div class="event-actions">
          <button class="pill-btn small" onclick="renderEvent('public')">Show</button>
          <button class="pill-btn small outline" onclick="showSensoryTips('public')">Sensory Tips</button>
        </div>
      </div>

      <div class="event-card" data-event="new">
        <h3>🔰 New / Stressful Environments</h3>
        <p class="clear-instruction">Instruction: Observe before interacting. Exit plan recommended.</p>
        <div class="event-actions">
          <button class="pill-btn small" onclick="renderEvent('new')">Show</button>
          <button class="pill-btn small outline" onclick="showSensoryTips('new')">Sensory Tips</button>
        </div>
      </div>
    </div>

    <div id="event-challenges" class="card quiet" aria-live="polite" style="margin-top:16px"></div>
  </section>
</main>

<!-- Modal for sensory tips -->
<div id="modal" class="modal" role="dialog" aria-hidden="true"></div>

<script>
/* fallback data & functions for this page (common.js also provides implementations but these ensure immediate working) */
const defaultChallenges = {
  workplace: [
    "Greet a colleague with a short smile and wave",
    "Work in 25 min blocks (timer) then take 5 minute break",
    "Find a quieter desk or use headphones during noisy times"
  ],
  family: [
    "Arrive with one clear goal (e.g., say hi, stay 1 hour)",
    "Find a seat near an exit for easy breaks"
  ],
  party: [
    "Introduce yourself to one person you feel comfortable with",
    "Step outside for fresh air when overwhelmed"
  ],
  public: [
    "Go during off-peak times where possible",
    "Plan a short route and a seat away from entrances"
  ],
  new: [
    "Observe for 5 minutes before engaging",
    "Identify an exit & a quiet place"
  ]
};

function renderEvent(key){
  const container = document.getElementById('event-challenges');
  container.innerHTML = `<h3>${key.charAt(0).toUpperCase()+key.slice(1)} — Challenges</h3>`;
  const list = document.createElement('ul');
  (defaultChallenges[key]||[]).forEach((c, idx)=>{
    const li = document.createElement('li');
    li.textContent = c;
    li.tabIndex = 0;
    li.className = 'challenge';
    li.addEventListener('click', ()=>{
      // mark done visually & store
      li.classList.toggle('done');
      storeCompleted(key, idx, li.classList.contains('done'));
      if(window.voiceHint) window.voiceHint.challengeDone();
      updateProgressUI();
    });
    list.appendChild(li);
  });
  container.appendChild(list);
  // basic instruction
  const inst = document.createElement('p');
  inst.className = 'muted';
  inst.textContent = 'Instruction: Click a challenge to mark it as done. Done items persist for this event.';
  container.appendChild(inst);
}
</script>
</body>
</html>
